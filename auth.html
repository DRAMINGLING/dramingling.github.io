<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>访问认证</title>
  <style>
    body { font-family: sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#f0f0f0; }
    .box { background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,.1); }
    input { padding:8px; width:200px; }
    button { padding:8px 12px; margin-left:8px; }
    .msg { margin-top:10px; color:red; }
  </style>
</head>
<body>
  <div class="box">
    <h2>请输入访问密钥</h2>
    <input type="password" id="key" placeholder="密钥">
    <button id="submit">确认</button>
    <div id="msg" class="msg"></div>
  </div>

<script>
  const SECRET = "13574271985"; // 修改为你自己的密钥
  const TOKEN_KEY = "pd_access_token";

  const params = new URLSearchParams(location.search);
  const redirectUrl = params.get("redirect");

  document.getElementById("submit").onclick = function() {
    const input = document.getElementById("key").value.trim();
    if (input === SECRET) {
      sessionStorage.setItem(TOKEN_KEY, "ok");
      // 跳转回原页面
      if (redirectUrl) {
        location.href = redirectUrl;
      } else {
        location.href = "/personal_documents/";
      }
    } else {
      document.getElementById("msg").textContent = "密钥错误，请重试";
    }
  };

  // 如果已经有 token 且有 redirect 参数，直接跳回
  if (sessionStorage.getItem(TOKEN_KEY) === "ok" && redirectUrl) {
    location.href = redirectUrl;
  }
</script>
</body>
</html>
